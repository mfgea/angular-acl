"use strict";angular.module("mm.acl",[]),angular.module("mm.acl").provider("AclService",[function(){function a(a,b){var c,d,e;if("number"==typeof a.length&&a.length>=0)for(c=0,d=a.length;d>c;c++)b(a[c],c,a);else for(e in a)a.hasOwnProperty(e)&&b(a[e],e,a);return a}function b(){var a;switch(c.storage){case"sessionStorage":a=i("sessionStorage");break;case"localStorage":a=i("localStorage");break;default:a=null}return a?(angular.extend(d,a),!0):!1}Array.prototype.indexOf||(Array.prototype.indexOf=function(a){for(var b=this.length;b--;)if(this[b]===a)return b;return-1});var c={storage:"sessionStorage",storageKey:"AclService"},d={roles:[],abilities:{}},e=function(a){return"object"==typeof d.abilities[a]},f=function(a){return e(a)?d.abilities[a]:[]},g=function(){switch(c.storage){case"sessionStorage":h("sessionStorage");break;case"localStorage":h("localStorage");break;default:return}},h=function(a){window[a].setItem(c.storageKey,JSON.stringify(d))},i=function(a){var b=window[a].getItem(c.storageKey);return b?JSON.parse(b):!1},j={};return j.resume=b,j.attachRole=function(a){-1===d.roles.indexOf(a)&&(d.roles.push(a),g())},j.detachRole=function(a){var b=d.roles.indexOf(a);b>-1&&(d.roles.splice(b,1),g())},j.flushRoles=function(){d.roles=[],g()},j.hasRole=function(a){return d.roles.indexOf(a)>-1},j.getRoles=function(){return d.roles},j.setAbilities=function(b){var c=this;d.abilities={},a(b,function(a,b){c.setRoleAbilities(b,a)}),g()},j.setRoleAbilities=function(b,c){var e=this;d.abilities[b]={},"string"==typeof c?e.addAbility(b,c):a(c,function(a,c){e.addAbility(b,c,a)}),g()},j.addAbility=function(a,b,c){d.abilities[a]||(d.abilities[a]={}),c||(c=["any"]),d.abilities[a][b]=c,g()},j.can=function(b,c){function e(a){var b=[];switch(a){case"write":b=["create","edit","delete"];break;case"create":case"edit":case"delete":b=["write"]}return b.push(a),b}function g(b,c){if(b.indexOf("none")>-1)return!1;if(b.indexOf("any")>-1||b.length&&c.indexOf("any")>-1)return!0;var d=!1;return a(c,function(a){b.indexOf(a)>-1&&(d=!0)}),d}var h,i,j=!1;return c||(c="any"),a(d.roles,function(a){h=f(a),i=e(c),h[b]&&g(h[b],i)&&(j=!0)}),j},j.canAny=function(a){for(var b,c,e=d.roles.length,g=a.length;e--;)for(b=d.roles[e],c=f(b);g--;)if(c.indexOf(a[g])>-1)return!0;return!1},{config:function(a){angular.extend(c,a)},resume:b,$get:function(){return j}}}]);